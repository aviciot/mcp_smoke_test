# MCP Smoke Test Configuration
# ============================

# MCP Configuration
mcp:
  name: "mcp-smoke"
  description: "Smoke Test MCP Server for comparing CSV files, database exports, and StorageGrid documents"

# Server Configuration
server:
  version: "1.0.0"
  host: "0.0.0.0"
  port: 8200  # Set MCP_PORT in .env to override
  
  # Authentication Configuration
  authentication:
    enabled: true  # Set AUTH_ENABLED in .env to override
    
    # API Keys with Role-Based Access Control
    # Generate secure keys: python -c "import secrets; print(secrets.token_urlsafe(32))"
    api_keys:
      - name: "admin"
        key: "${ADMIN_API_KEY}"
        role: "admin"
        description: "Administrator - full access, can override safety limits"
      
      - name: "user"
        key: "${USER_API_KEY}"
        role: "user"
        description: "Standard user - full access with safety checks enforced"
      
      - name: "development"
        key: "dev-api-key-12345-insecure"
        role: "user"
        description: "Development key (DO NOT USE IN PRODUCTION)"
    
    # Public endpoints (no authentication required)
    public_endpoints:
      - "/health"
      - "/healthz"
      - "/version"
      - "/_info"

# PostgreSQL Database Configuration (MCP internal database)
database:
  host: "localhost"
  port: 5436  # External port (mapped from container's 5432)
  name: "mcp"
  schema: "mcp_smoke"
  user: "mcp"
  password: "${DB_PASSWORD}"  # Set in .env
  pool_size: 10
  max_overflow: 20

# Predefined Databases for Comparison
# These databases can be referenced by name in compare_database_tables tool
comparison_databases:
  # Oracle Databases
  oracle_prod:
    type: "oracle"
    description: "Production Oracle Database"
    host: "${ORACLE_PROD_HOST}"
    port: 1521
    service_name: "${ORACLE_PROD_SERVICE}"
    user: "${ORACLE_PROD_USER}"
    password: "${ORACLE_PROD_PASSWORD}"
    
  oracle_test:
    type: "oracle"
    description: "Test Oracle Database"
    host: "${ORACLE_TEST_HOST}"
    port: 1521
    service_name: "${ORACLE_TEST_SERVICE}"
    user: "${ORACLE_TEST_USER}"
    password: "${ORACLE_TEST_PASSWORD}"
  
  # MySQL Databases
  mysql_prod:
    type: "mysql"
    description: "Production MySQL Database"
    host: "${MYSQL_PROD_HOST}"
    port: 3306
    database: "${MYSQL_PROD_DATABASE}"
    user: "${MYSQL_PROD_USER}"
    password: "${MYSQL_PROD_PASSWORD}"
    
  mysql_test:
    type: "mysql"
    description: "Test MySQL Database"
    host: "${MYSQL_TEST_HOST}"
    port: 3306
    database: "${MYSQL_TEST_DATABASE}"
    user: "${MYSQL_TEST_USER}"
    password: "${MYSQL_TEST_PASSWORD}"
  
  # PostgreSQL Databases
  postgres_prod:
    type: "postgresql"
    description: "Production PostgreSQL Database"
    host: "${POSTGRES_PROD_HOST}"
    port: 5432
    database: "${POSTGRES_PROD_DATABASE}"
    user: "${POSTGRES_PROD_USER}"
    password: "${POSTGRES_PROD_PASSWORD}"
    
  postgres_test:
    type: "postgresql"
    description: "Test PostgreSQL Database"
    host: "${POSTGRES_TEST_HOST}"
    port: 5432
    database: "${POSTGRES_TEST_DATABASE}"
    user: "${POSTGRES_TEST_USER}"
    password: "${POSTGRES_TEST_PASSWORD}"

# Safety Limits for Database Comparisons
comparison_safety:
  max_execution_time_sec: 300  # 5 minutes (can be overridden by admin)
  max_response_time_ms: 5000   # 5 seconds for DB availability check
  warn_row_count: 1000000      # Warn if query returns > 1M rows
  admin_can_override: true     # Allow admin to bypass limits

# StorageGrid Configuration
storagegrid:
  endpoint: "${STORAGEGRID_ENDPOINT}"
  access_key: "${STORAGEGRID_ACCESS_KEY}"
  secret_key: "${STORAGEGRID_SECRET_KEY}"
  bucket_name: "${STORAGEGRID_BUCKET}"
  region: "us-east-1"

# Smoke Test Configuration
smoke_test:
  # Test file paths
  tests_dir: "./tests"
  uploads_dir: "./uploads"
  reports_dir: "./reports"
  
  # Report configuration
  report:
    format: "html"  # html, csv, or both
    max_rows_display: 100  # Max mismatches to show in HTML
    include_summary: true
    
  # File cleanup
  cleanup:
    enabled: true
    retention_days: 30  # Delete test files older than 30 days

# Logging
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  format: "text"  # text or json
  
# Feedback System
feedback:
  enabled: true
  github:
    enabled: true
    repo: "aviciot/mcp_smoke_test"
    token: "${GITHUB_TOKEN}"  # Set in .env for feedback creation

